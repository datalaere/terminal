let stylesheets="public/css/",commandHistory=[],historyIndex=-1,currentDirectory="",isPasswordPrompt=!1,userPassword="",usernameForLogon="",usernameForNewUser="",isUsernamePrompt=!1,currentCommand="";function sendCommand(e,t,n=""){let o=window.location.search,r=e.split(" ")[0];$.ajax({type:"GET",url:r.toLowerCase()+n,data:{data:t,query:o},success:function(e){isPasswordPrompt?handlePasswordPromptResponse(e):(loadText(e),handleRedirect(e))}})}function appendCommand(e){let t=$("<div>").addClass("command-prompt").html(e);$("#terminal").append(t),scrollToBottom()}function handleUserInput(){let e=$("#command-input").val().trim();if(""===e)return;if(loadText("cmd:>"+e),commandHistory.push(e),historyIndex=commandHistory.length,$("#command-input").val(""),isUsernamePrompt){if(e){"newuser"===currentCommand?(usernameForNewUser=e,loadText("ENTER PASSWORD NOW:"),isUsernamePrompt=!1,isPasswordPrompt=!0,$("#command-input").attr("type","password")):("login"===currentCommand||"logon"===currentCommand)&&(usernameForLogon=e,loadText("ENTER PASSWORD:"),isUsernamePrompt=!1,isPasswordPrompt=!0,$("#command-input").attr("type","password"));return}loadText("ERROR: WRONG USERNAME!");return}if(isPasswordPrompt){handlePasswordPrompt();return}let t=e.split(" "),n=t[0],o=t.slice(1).join(" ");if(["newuser","logon","login"].includes(n)&&!sessionStorage.getItem("uplink")){loadText("ERROR: Uplink Required!");return}if("clear"===n||"cls"===n)clearTerminal();else if("uplink"===n)sessionStorage.setItem("uplink",!0),sendCommand(n,o);else if("newuser"===n){if(!o){loadText("ENTER USERNAME NOW:"),isUsernamePrompt=!0,currentCommand="newuser",$("#command-input").attr("type","text");return}handleNewUser(o)}else if("logon"===n||"login"===n){if(!o){loadText("ENTER USERNAME:"),isUsernamePrompt=!0,currentCommand=n,$("#command-input").attr("type","text");return}handleLogon(o)}else["logout","logoff","reboot","dc","restart","start","autoexec","exit"].includes(n)?(loadText("Please wait..."),sendCommand(n,o),setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2500)):"color"===n?setTheme(o):sendCommand(n,o)}function autocompleteCommand(){let e=$("#command-input"),t=e.val().trim();""!==t&&$.ajax({type:"GET",url:"auto.php",data:{input:t},success:function(n){let o=JSON.parse(n);if(o.length>0){let r=o[0],a=t.lastIndexOf(" "),s=t.substring(0,a+1);t.substring(a+1),e.val(s+r),e[0].setSelectionRange(s.length+r.length,s.length+r.length)}}})}function handleRedirect(e){e.startsWith("Contacting")&&setTimeout(function(){loadText("Accessing Mainframe..."),setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2e3)},2e3),e.startsWith("EXCACT")&&setTimeout(function(){setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2500)},2e3),e.startsWith("Password")&&setTimeout(function(){setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2500)},2e3),e.startsWith("Security")&&setTimeout(function(){loadText("Welcome to ARPANET!"),setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2500)},2e3)}function redirectTo(e){setTimeout(function(){window.location.href=e},2500)}function handleLogon(e){if(!sessionStorage.getItem("uplink")){loadText("ERROR: Uplink Required!");return}if(!usernameForLogon&&!e){loadText("ENTER USERNAME:"),isUsernamePrompt=!0,$("#command-input").attr("type","text");return}isPasswordPrompt||(isPasswordPrompt=!0,usernameForLogon=e,loadText("ENTER PASSWORD:"),$("#command-input").attr("type","password"))}function handleNewUser(e){if(!sessionStorage.getItem("uplink")){loadText("ERROR: Uplink Required!");return}if(!usernameForNewUser&&!e){loadText("ENTER USERNAME NOW:"),isUsernamePrompt=!0,$("#command-input").attr("type","text");return}isPasswordPrompt||(isPasswordPrompt=!0,usernameForNewUser=e,loadText("ENTER PASSWORD NOW:"),$("#command-input").attr("type","password"))}function handlePasswordPrompt(){let e=$("#command-input").val().trim();userPassword=e,"logon"===currentCommand||"login"===currentCommand?(sendCommand(currentCommand,usernameForLogon+" "+e),usernameForLogon=""):"newuser"===currentCommand&&(sendCommand("newuser",usernameForNewUser+" "+e),usernameForNewUser=""),isPasswordPrompt=!1,$("#command-input").attr("type","text").val("")}function handlePasswordPromptResponse(e){e.startsWith("ERROR")||e.startsWith("WARNING")?(loadText(e),isPasswordPrompt=!1,$("#command-input").attr("type","text")):e.startsWith("Password")?(loadText(e),setTimeout(function(){clearTerminal(),sendCommand("welcome","")},2500)):usernameForLogon?sendCommand("logon",usernameForLogon+" "+userPassword):usernameForNewUser&&sendCommand("newuser",usernameForNewUser+" "+userPassword),$("#command-input").val("")}function loadText(e){let t=0,n=$("<pre>").css({"white-space":"pre-wrap","word-wrap":"break-word"});$("#terminal").append(n),!function o(){t<e.length?(n.append(e[t]),t++,scrollToBottom(),setTimeout(o,5)):$("#command-input").focus()}()}function simulateCRT(e,t){$("#command-input").val("");let n=0,o=$("<div>");t.append(o),!function r(){if(n<e.length){let a="";for(;n<e.length&&" "!==e[n];)a+=e[n],n++;n++;let s=$("<span>").text(a+" ");o.append(s),t[0].scrollWidth>t[0].clientWidth&&(s.remove(),o=$("<div>").append(s),t.append(o)),setTimeout(r,5)}else scrollToBottom()}()}function scrollToBottom(){let e=document.getElementById("terminal-wrapper");e.scrollTop=e.scrollHeight,$("#terminal-wrapper").scrollTop($("#terminal-wrapper")[0].scrollHeight)}function loadSavedTheme(){let e=localStorage.getItem("theme");e&&setTheme(e)}function clearTerminal(){$("#terminal").empty()}function setTheme(e){$("#theme-color").attr("href",stylesheets+e+"-crt.css"),localStorage.setItem("theme",e)}$(document).ready(function(){loadSavedTheme(),sessionStorage.getItem("boot")?setTimeout(function(){sendCommand("welcome","")},500):(setTimeout(function(){sendCommand("boot","")},500),setTimeout(function(){sessionStorage.setItem("boot",!0),clearTerminal(),sendCommand("welcome","")},1e4))}),$("#command-input").keydown(function(e){"Enter"===e.key?isPasswordPrompt?handlePasswordPrompt():handleUserInput():"ArrowUp"===e.key?historyIndex>0&&(historyIndex--,$("#command-input").val(commandHistory[historyIndex])):"ArrowDown"===e.key?historyIndex<commandHistory.length-1?(historyIndex++,$("#command-input").val(commandHistory[historyIndex])):(historyIndex=commandHistory.length,$("#command-input").val("")):"Tab"===e.key&&(e.preventDefault(),autocompleteCommand())});