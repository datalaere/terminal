
let path_public='public/';let stylesheets=path_public+'css/';let commandHistory=[];let historyIndex=-1;let currentDirectory='';let isPasswordPrompt=false;let userPassword='';let usernameForLogon='';let usernameForNewUser='';let isUsernamePrompt=false;let currentCommand='';$(document).ready(function(){loadSavedTheme();if(!sessionStorage.getItem('boot')){setTimeout(function(){sendCommand('boot','')},500);setTimeout(function(){sessionStorage.setItem('boot',true);clearTerminal();sendCommand('welcome','')},10000)}else{setTimeout(function(){sendCommand('welcome','')},500)}});$('#command-input').keydown(function(e){if(e.key==='Enter'){if(isPasswordPrompt){handlePasswordPrompt()}else{handleUserInput()}}else if(e.key==='ArrowUp'){if(historyIndex>0){historyIndex--;$('#command-input').val(commandHistory[historyIndex])}}else if(e.key==='ArrowDown'){if(historyIndex<commandHistory.length-1){historyIndex++;$('#command-input').val(commandHistory[historyIndex])}else{historyIndex=commandHistory.length;$('#command-input').val('')}}else if(e.key==='Tab'){e.preventDefault();autocompleteCommand()}});function sendCommand(command,data,queryString=''){const query=window.location.search;const route=command.split(" ")[0];$.ajax({type:'GET',url:route.toLowerCase()+queryString,data:{data:data,query:query},success:function(response){if(isPasswordPrompt){handlePasswordPromptResponse(response)}else{loadText(response);handleRedirect(response)}}})}function appendCommand(command){const commandElement=$('<div>').addClass('command-prompt').html(command);$('#terminal').append(commandElement);scrollToBottom()}function handleUserInput(){const input=$('#command-input').val().trim();if(input==='')return;loadText("cmd:>"+input);commandHistory.push(input);historyIndex=commandHistory.length;$('#command-input').val('');if(isUsernamePrompt){if(input){if(currentCommand==='newuser'){usernameForNewUser=input;loadText("ENTER PASSWORD NOW:");isUsernamePrompt=false;isPasswordPrompt=true;$('#command-input').attr('type','password')}else if(currentCommand==='login'||currentCommand==='logon'){usernameForLogon=input;loadText("ENTER PASSWORD:");isUsernamePrompt=false;isPasswordPrompt=true;$('#command-input').attr('type','password')}return}else{loadText("ERROR: WRONG USERNAME!");return}}if(isPasswordPrompt){handlePasswordPrompt();return}const parts=input.split(' ');const command=parts[0];const args=parts.slice(1).join(' ');if(['newuser','logon','login'].includes(command)&&!sessionStorage.getItem('uplink')){loadText("ERROR: Uplink Required.");return}if(command==='clear'||command==='cls'){clearTerminal()}else if(command==='uplink'){sessionStorage.setItem('uplink',true);sendCommand(command,args)}else if(command==='newuser'){if(!args){loadText("ENTER USERNAME NOW:");isUsernamePrompt=true;currentCommand='newuser';$('#command-input').attr('type','text');return}handleNewUser(args)}else if(command==='logon'||command==='login'){if(args){usernameForLogon=args;loadText("ENTER PASSWORD:");isUsernamePrompt=false;isPasswordPrompt=true;currentCommand=command;$('#command-input').attr('type','password');return}else{loadText("ENTER USERNAME:");isUsernamePrompt=true;currentCommand=command;$('#command-input').attr('type','text');return}}else if(['logout','logoff','reboot','dc','restart','start','autoexec','exit'].includes(command)){loadText("Please wait...");sendCommand(command,args);setTimeout(function(){redirectTo('')},2000)}else if(command==='color'){setTheme(args)}else{sendCommand(command,args)}}function autocompleteCommand(){const inputElement=$('#command-input');let input=inputElement.val().trim();if(input==='')return;$.ajax({type:'GET',url:'auto.php',data:{input:input},success:function(response){const suggestions=JSON.parse(response);if(suggestions.length>0){const suggestion=suggestions[0];const lastSpaceIndex=input.lastIndexOf(' ');const prefix=input.substring(0,lastSpaceIndex+1);const suffix=input.substring(lastSpaceIndex+1);inputElement.val(prefix+suggestion);inputElement[0].setSelectionRange(prefix.length+suggestion.length,prefix.length+suggestion.length)}}})}function handleRedirect(response){if(response.startsWith("Trying")){setTimeout(function(){loadText("SUCCESS: Connecting to Host");setTimeout(function(){redirectTo('')},1000)},1000)}if(response.startsWith("EXCACT")){setTimeout(function(){setTimeout(function(){redirectTo('')},1000)},1000)}if(response.startsWith("Password")){setTimeout(function(){setTimeout(function(){redirectTo('')},1000)},1000)}if(response.startsWith("SUCCESS")){setTimeout(function(){setTimeout(function(){redirectTo('')},1000)},1000)}if(response.startsWith("Security")){setTimeout(function(){loadText("SUCCESS: Welcome to Arpanet");setTimeout(function(){redirectTo('')},1000)},1000)}}function redirectTo(url){clearTerminal();sendCommand('welcome','');$('#user').load('connection')}function handleLogon(username){if(!sessionStorage.getItem('uplink')){loadText("ERROR: Uplink Required.");return}if(!usernameForLogon&&!username){loadText("ENTER USERNAME:");isUsernamePrompt=true;$('#command-input').attr('type','text');return}if(isPasswordPrompt)return;isPasswordPrompt=true;usernameForLogon=username;loadText("ENTER PASSWORD:");$('#command-input').attr('type','password')}function handleNewUser(username){if(!sessionStorage.getItem('uplink')){loadText("ERROR: Uplink Required.");return}if(!usernameForNewUser&&!username){loadText("ENTER USERNAME NOW:");isUsernamePrompt=true;$('#command-input').attr('type','text');return}if(isPasswordPrompt)return;isPasswordPrompt=true;usernameForNewUser=username;loadText("ENTER PASSWORD NOW:");$('#command-input').attr('type','password')}function handlePasswordPrompt(){const password=$('#command-input').val().trim();userPassword=password;if(currentCommand==='logon'||currentCommand==='login'){sendCommand(currentCommand,usernameForLogon+' '+password);usernameForLogon=''}else if(currentCommand==='newuser'){sendCommand('newuser',usernameForNewUser+' '+password);usernameForNewUser=''}isPasswordPrompt=false;$('#command-input').attr('type','text').val('')}function handlePasswordPromptResponse(response){if(response.startsWith("ERROR")||response.startsWith("WARNING")){loadText(response);isPasswordPrompt=false;$('#command-input').attr('type','text')}else if(response.startsWith("Password")){loadText(response);setTimeout(function(){clearTerminal();sendCommand('welcome','')},2500)}else{if(usernameForLogon){sendCommand('logon',usernameForLogon+' '+userPassword)}else if(usernameForNewUser){sendCommand('newuser',usernameForNewUser+' '+userPassword)}}$('#command-input').val('')}function loadText(text){let currentIndex=0;const preContainer=$('<pre>').css({'white-space':'pre-wrap','word-wrap':'break-word'});$('#terminal').append(preContainer);function displayNextLetter(){if(currentIndex<text.length){preContainer.append(text[currentIndex]);currentIndex++;scrollToBottom();setTimeout(displayNextLetter,5)}else{$('#command-input').focus()}}displayNextLetter()}function simulateCRT(text,container){const delay=5;const inputField=$('#command-input').val('');let currentIndex=0;let currentLine=$('<div>');container.append(currentLine);function displayNextWord(){if(currentIndex<text.length){let word='';while(currentIndex<text.length&&text[currentIndex]!==' '){word+=text[currentIndex];currentIndex++}currentIndex++;const wordElement=$('<span>').text(word+' ');currentLine.append(wordElement);if(container[0].scrollWidth>container[0].clientWidth){wordElement.remove();currentLine=$('<div>').append(wordElement);container.append(currentLine)}setTimeout(displayNextWord,delay)}else{scrollToBottom()}}displayNextWord()}function scrollToBottom(){const terminal=document.getElementById('terminal-wrapper');terminal.scrollTop=terminal.scrollHeight;$('#terminal-wrapper').scrollTop($('#terminal-wrapper')[0].scrollHeight)}function loadSavedTheme(){const savedTheme=localStorage.getItem('theme');if(savedTheme){setTheme(savedTheme)}}function clearTerminal(){$('#terminal').empty()}function setTheme(color){$('#theme-color').attr('href',stylesheets+color+'-crt.css');localStorage.setItem('theme',color)}let currentSongIndex=0;const audio=new Audio(playlist[currentSongIndex]);audio.loop=false;let userInteracted=localStorage.getItem('music')==='true';function toggleMusic(){if(audio.paused){audio.play().then(()=>{console.log('Audio started playing.');document.getElementById('play-button').textContent='STOP MUSIC'}).catch(error=>{console.error('Playback failed:',error)})}else{audio.pause();console.log('Audio paused.');document.getElementById('play-button').textContent='PLAY MUSIC'}}document.getElementById('play-button').addEventListener('click',toggleMusic);audio.addEventListener('ended',()=>{currentSongIndex++;if(currentSongIndex<playlist.length){audio.src=playlist[currentSongIndex];audio.play().catch(error=>{console.warn('Playback failed:',error)})}else{currentSongIndex=0;audio.src=playlist[currentSongIndex];audio.play().catch(error=>{console.warn('Playback failed:',error)})}});if(userInteracted){document.addEventListener('click',()=>{if(audio.paused){audio.play().catch(error=>{console.warn('Autoplay blocked or failed:',error)})}},{once:true})}